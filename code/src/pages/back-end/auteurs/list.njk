{% extends "layouts/back-end/base.njk" %}

{% set active_menu_item = "authors" %}
{% set using_asc = query_string_params.sorting == "asc" %}
{% set sort_param = "desc" if using_asc == true else "asc" %}
{% set sort_text = "Trier du plus récent au plus ancien" if using_asc == true else "Trier du plus ancien au plus récent" %}

{% import "components/back-end/pagination.njk" as pagination with context %}
{% import "components/back-end/list-actions.njk" as list_actions %}

{% block main %}
  <div class="bg-white rounded-2xl shadow-md pb-6">
    <header class="mb-1 p-6 gap-2 @3xl/main:gap-0 flex justify-between @3xl/main:flex-row flex-col">
      <div>
        {% include "components/back-end/breadcrumb.njk" %}
        <h2 class="text-4xl">
          Liste auteurs
        </h2>
        <p class="text-sm">{{ list_authors.count }} éléments au total</p>
      </div>

      <div class="flex gap-3 flex-col @xl:flex-row">
        <a href="{{ admin_url ~ "/auteurs/add" }}" class="inline-flex gap-1 w-full sm:w-fit text-md text-white rounded-2xl items-center text-sm py-2 px-4 bg-blue-700 hocus:bg-blue-950 h-fit justify-center">
          <svg aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
          </svg>
          Ajouter un nouvel auteur
        </a>

        <a href="{{ '?sorting=' ~ sort_param }}" class="w-full flex gap-1 justify-center @3xl/main:hidden sm:w-fit text-md bg-neutral-100 hocus:bg-neutral-200 text-black rounded-2xl items-center text-sm py-2 px-4 h-fit text-center">
          {% if using_asc %}
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3 4.5h14.25M3 9h9.75M3 13.5h5.25m5.25-.75L17.25 9m0 0L21 12.75M17.25 9v12" />
            </svg>
          {% else %}
            <svg aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3 4.5h14.25M3 9h9.75M3 13.5h9.75m4.5-4.5v12m0 0-3.75-3.75M17.25 21 21 17.25" />
            </svg>
          {% endif %}
          {{ sort_text }}
        </a>
      </div>
    </header>

    <div class="px-6">
      {% for item in list_errors %}
        <p class="rounded-lg p-3 bg-red-100 text-red-800 border-solid border-x border-y border-red-700 mb-3">
          {{ item | safe }}
        </p>
      {% endfor %}
    </div>

    <div class="tooltip hidden bg-slate-800 text-white border border-gray-200 border-solid py-2 px-4 rounded-2xl" data-tooltip="sort">
      <p class="text-sm">{{ sort_text }}</p>
    </div>

    <table class="w-full bg-white border-collapse">
      <thead>
        <tr class="text-slate-800">
          <th class="font-bold px-6 py-3 text-left border-solid border-slate-200 border-b min-w-52">
            Auteur
          </th>
          <th class="font-bold px-6 py-3 text-left border-solid border-slate-200 border-b">
            Email
          </th>
          <th class="font-bold px-6 py-3 text-left border-solid border-slate-200 border-b">
            Bio / description
          </th>
          <th class="font-bold px-6 py-3 text-left border-solid border-slate-200 border-b">
            Nombre d’articles
          </th>
          <th class="font-bold text-left border-solid border-slate-200 border-b hover:bg-blue-50">
            <a href="{{ '?sorting=' ~ sort_param }}" class="flex gap-2 px-6 py-3 items-center" aria-sort="{{ 'ascending' if using_asc else 'descending' }}" title="{{ sort_text }}" data-tooltip-anchor="sort">
              <span>Dernière mise à jour</span>
              <div class="shrink-0">
                {% if using_asc %}
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 4.5h14.25M3 9h9.75M3 13.5h5.25m5.25-.75L17.25 9m0 0L21 12.75M17.25 9v12" />
                  </svg>
                {% else %}
                  <svg aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 4.5h14.25M3 9h9.75M3 13.5h9.75m4.5-4.5v12m0 0-3.75-3.75M17.25 21 21 17.25" />
                  </svg>
                {% endif %}
              </div>
            </a>
          </th>
          <th class="px-6 py-3 border-solid border-slate-200 border-b"></th>
        </tr>
      </thead>

      <tbody>
        {% for item in list_authors.data %}
          <tr class="hover:bg-neutral-50 even:bg-blue-50">
            {# Auteur + image + couleur #}
            <td class="bg-transparent border-solid border-slate-200 border-b py-4 px-6 min-w-52" data-label="Auteur">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full overflow-hidden bg-neutral-200 shrink-0">
                  {% if item.image %}
                    <img
                      src="/uploads/{{ item.image }}"
                      alt="Photo de {{ item.firstname }} {{ item.lastname }}"
                      class="w-full h-full object-cover"
                    >
                  {% else %}
                    <span class="sr-only">Pas de photo</span>
                  {% endif %}
                </div>
                <div>
                  <p class="font-semibold">
                    {{ item.firstname }} {{ item.lastname }}
                  </p>
                  <p class="text-xs text-slate-500 flex items-center gap-2 mt-1">
                    <span
                      class="inline-block w-3 h-3 rounded-full border border-slate-300"
                      style="background-color: {{ item.color }};"
                      aria-hidden="true"
                    ></span>
                    <span>{{ item.color }}</span>
                  </p>
                </div>
              </div>
            </td>

            {# Email #}
            <td class="bg-transparent border-solid border-slate-200 border-b py-4 px-6" data-label="Email">
              <a href="mailto:{{ item.email }}" class="text-blue-700 hocus:underline">
                {{ item.email }}
              </a>
            </td>

            {# Bio #}
            <td class="py-4 px-6 bg-transparent border-solid border-slate-200 border-b shadow-transparent" data-label="Bio / description">
              <p class="line-clamp-2 md:line-clamp-1" title="{{ item.bio }}">{{ item.bio }}</p>
            </td>

            {# Nombre d’articles #}
            <td class="bg-transparent border-solid border-slate-200 border-b py-4 px-6" data-label="Nombre d’articles">
              {{ item.nb_articles or 0 }}
            </td>

            {# Dernière mise à jour #}
            <td class="bg-transparent border-solid border-slate-200 border-b py-4 px-6" data-label="Dernière mise à jour">
              <time datetime="{{ item.updated_at }}">{{ item.updated_at | date("dd/LL/yyyy à HH:mm") }}</time>
            </td>

            {# Actions #}
            <td class="py-4 px-6 bg-transparent border-solid border-slate-200 border-b-2 @-3xl/main:border-b! shadow-transparent lg:text-right align-middle">
              <div class="inline-flex gap-6 w-full justify-around">
                {{ list_actions.edit(admin_url ~ '/auteurs/' ~ item._id) }}
                {{ list_actions.delete(base_url ~ '/api/authors/' ~ item._id, item.firstname ~ ' ' ~ item.lastname) }}
              </div>
            </td>
          </tr>
        {% else %}
          <tr>
            <td colspan="5" class="text-center bg-transparent border-solid border-slate-200 border-b py-4 px-6">
              Pas de contenu pour le moment
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <footer class="flex justify-between px-4 flex-col @3xl/main:flex-row relative items-center">
      {{ pagination.item(list_authors) }}
    </footer>
  </div>
{% endblock %}
